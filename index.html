<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏¢‡∏≤ Warfarin ‡∏´‡πâ‡∏≠‡∏á‡∏¢‡∏≤‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏û‡∏∏‡∏ô‡∏û‡∏¥‡∏ô</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
/* --- COPY PROTECTION STYLES (‡πÄ‡∏î‡∏¥‡∏°) --- */
body {
    user-select: none; /* Standard syntax */
    -webkit-user-select: none; /* Safari */
    -moz-user-select: none; /* Firefox */
    -ms-user-select: none; /* IE/Edge */
    background:linear-gradient(180deg,var(--bg),#FFFFFF);
    margin:0;
    padding:20px;
    color:#263238;
}
/* ------------------------------- */

:root{
    --bg:#F0F8FF; 
    --card:#FFFFFF;
    --accent:#00A896;
    --accent-light:#CCEEEA;
    --muted:#5A6A70;
    --highlight:#75C2B9;

    --plan-bg-1: #F8FFFF;
    --plan-bg-2: #FFFBF8;
    --plan-bg-3: #FAF8FF;
    --plan-border-1: #40B2D6;
    --plan-border-2: #FFAD60;
    --plan-border-3: #AA8CFF;

    --main-pink: #E91E63;
    --light-pink: #FDE8F1;
    --accent-green: #4CAF50;
    font-family: 'Kanit', sans-serif;
}
body::before{
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ logo1.gif ‡πÉ‡∏ô path ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á */
    background: url('logo1.gif') center center no-repeat; 
    background-size: 380px auto;
    opacity: 0.06;
    z-index: -1;
}
header{display:flex;align-items:center;gap:12px}
h1{margin:0;font-size:20px;text-align:center;flex:1;color:var(--accent)}
.container{max-width:980px;margin:20px auto}
.card{background:var(--card);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,0.08);padding:18px;margin-bottom:16px;border-top:4px solid var(--highlight)}
label{display:block;font-size:14px;margin-bottom:6px;color:var(--muted)}
input[type=number]{width:100%;padding:10px;border-radius:10px;border:1px solid #cfd8dc;font-size:16px;background:#FAFAFA;}
.row{display:flex;gap:12px}
.col{flex:1}
.radio-row{display:flex;gap:10px;flex-wrap:wrap}
.pill{padding:8px 14px;border-radius:20px;border:1px solid #B2DFDB;background:#E0F2F1;cursor:pointer;transition:all 0.2s ease}
.pill:hover{background:var(--highlight);color:#004D40}
button.primary{background:var(--accent);color:#fff;border:0;padding:12px 20px;border-radius:12px;font-weight:600;cursor:pointer;transition:all 0.2s ease}
button.primary:hover{background:#008F85}
.result{margin-top:12px}
table{width:100%;border-collapse:collapse;border-radius:10px;overflow:hidden; table-layout: fixed; }
th,td{padding:8px;border-bottom:1px solid #E0F2F1;text-align:center; font-size: 14px;}
th{background:var(--accent-light);color:#004D40}
.plan-table tbody tr:nth-child(odd) { background-color: #F8F8F8; }
.plan-table.plan-1 tbody tr:nth-child(odd) { background-color: #F9FFFF; }
.plan-table.plan-2 tbody tr:nth-child(odd) { background-color: #FFFFF9; }
.plan-table.plan-3 tbody tr:nth-child(odd) { background-color: #FCFAFF; }
.small{font-size:13px;color:var(--muted)}
.note{background:var(--accent-light);padding:10px;border-radius:10px;margin-top:8px;white-space:pre-line;color:#004D40}
footer{font-size:13px;color:var(--muted);text-align:center;padding:8px}
@media(max-width:720px){.row{flex-direction:column}}
.plan-section { padding: 15px; margin-top: 15px; border-radius: 12px; border: 1px solid #eee; box-shadow: 0 2px 8px rgba(0,0,0,0.05); overflow-x: auto;}
.plan-section.plan-1 { background-color: var(--plan-bg-1); border-left: 5px solid var(--plan-border-1);}
.plan-section.plan-2 { background-color: var(--plan-bg-2); border-left: 5px solid var(--plan-border-2);}
.plan-section.plan-3 { background-color: var(--plan-bg-3); border-left: 5px solid var(--plan-border-3);}
.plan-table { min-width: 700px; }
.plan-grid { display: flex; justify-content: space-between; gap: 8px; margin-bottom: 16px; overflow-x: auto; padding-bottom: 8px; }
.day-card { min-width: 120px; flex-grow: 1; text-align: center; padding: 10px 5px; border-radius: 12px; border: 1px solid #E0E0E0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); background-color: #FFFFFF; }
.day-name { font-weight: 600; padding: 2px 0; margin-bottom: 4px; border-radius: 8px; color: #333; }
.day-name.mon { background-color: #FFECC6; border: 1px solid #FFC107; color: #333; }
.day-name.tue { background-color: #E6E1F4; border: 1px solid #673AB7; color: #333; }
.day-name.wed { background-color: #E6F7E6; border: 1px solid #4CAF50; color: #333; }
.day-name.thu { background-color: #FEEED7; border: 1px solid #FF9800; color: #333; }
.day-name.fri { background-color: #E1F1FD; border: 1px solid #2196F3; color: #333; }
.day-name.sat { background-color: #FDE8F1; border: 1px solid #E91E63; color: #333; }
.day-name.sun { background-color: #FCE6E6; border: 1px solid #F44336; color: #333; }
.daily-mg { font-size: 14px; color: #4CAF50; font-weight: 500; margin-bottom: 6px; }
.daily-dose-text { font-size: 12px; color: var(--muted); line-height: 1.4; margin-top: 4px; }
.pill-container { display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; align-items: center; padding: 4px 0; min-height: 32px; }
.pill-icon-wrapper { position: relative; display: inline-block; flex-shrink: 1; --pill-size: 24px; }
.pill-icon { width: var(--pill-size); height: var(--pill-size); border-radius: 50%; display: inline-block; cursor: default; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.2s ease; }
.pill-icon-3mg { background-color: #4FC3F7; } /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ */
.pill-icon-2mg { background-color: #FFB74D; } /* ‡∏™‡∏µ‡∏™‡πâ‡∏° */
.half-pill { width: var(--pill-size); height: var(--pill-size); border-radius: 50%; clip-path: polygon(0 0, 50% 0, 50% 100%, 0 100%); }
.pill-container.shrink-pills .pill-icon-wrapper { --pill-size: 18px; gap: 2px; }
.pill-icon-wrapper .tooltip-text { visibility: hidden; background-color: #333; color: #fff; text-align: center; border-radius: 6px; padding: 5px 8px; position: absolute; z-index: 10; bottom: 125%; left: 50%; transform: translateX(-50%); white-space: nowrap; opacity: 0; transition: opacity 0.2s; font-size: 12px; }
.pill-icon-wrapper:hover .tooltip-text { visibility: visible; opacity: 1; }
.pill-icon-wrapper .tooltip-text::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: #333 transparent transparent transparent; }
.summary-pill { display: inline-block; width: 14px; height: 14px; border-radius: 50%; margin-right: 5px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
.summary-line { font-size: 14px; margin-top: 5px; }

/* --- ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Warfarin ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏π‡∏ì‡∏ß‡∏±‡∏ô (‡πÉ‡∏´‡∏°‡πà) --- */
.standalone-calculator {
    max-width: 980px;
    margin: 20px auto 0;
    padding: 18px;
    background: var(--card);
    border-radius: 16px;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
    border-top: 4px solid var(--main-pink); 
}

.calculator-header-new {
    font-size: 20px;
    font-weight: 600;
    color: var(--main-pink);
    padding-bottom: 10px;
    border-bottom: 2px solid var(--light-pink);
    margin-bottom: 15px;
    text-align: center;
}

/* ‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ Flexbox ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á 2mg, 3mg ‡πÅ‡∏•‡∏∞ Comparison */
.dosing-comparison-container {
    display: flex;
    gap: 12px;
}

/* ‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏¢‡πà‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Warfarin 2mg ‡πÅ‡∏•‡∏∞ 3mg (‡πÉ‡∏´‡πâ‡πÅ‡∏ö‡πà‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÜ ‡∏Å‡∏±‡∏ô) */
.pill-dosing-container {
    display: flex;
    flex-direction: column; /* ‡∏à‡∏±‡∏î‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö */
    flex: 1 1 30%; /* ‡πÅ‡∏ö‡πà‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡πÜ ‡∏Å‡∏±‡∏ô 30% */
}

.dose-input-group {
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 8px;
    flex-grow: 1; /* ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏ö‡∏¢‡∏∑‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á column */
}

/* üåü ‡∏™‡πÑ‡∏ï‡∏•‡πå Warfarin 2 mg (‡πÇ‡∏ó‡∏ô‡∏™‡πâ‡∏°) */
#dose2mgContainer {
    background: #FFFBF8; /* ‡∏Ç‡∏≤‡∏ß‡∏≠‡∏°‡∏™‡πâ‡∏° */
    border: 1px solid #FFAD60;
}
#dose2mgContainer .pill-section-title {
    color: #FFAD60;
    border-bottom: 1px dashed #FFDDAA;
}

/* üåü ‡∏™‡πÑ‡∏ï‡∏•‡πå Warfarin 3 mg (‡πÇ‡∏ó‡∏ô‡∏ü‡πâ‡∏≤) */
#dose3mgContainer {
    background: #F8FFFF; /* ‡∏Ç‡∏≤‡∏ß‡∏≠‡∏°‡∏ü‡πâ‡∏≤ */
    border: 1px solid #40B2D6;
}
#dose3mgContainer .pill-section-title {
    color: #40B2D6;
    border-bottom: 1px dashed #A0D0E0;
}

.dose-input-row {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-top: 8px;
    font-size: 13px; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô */
}

.dose-input-row label {
    flex-basis: auto;
    font-size: 13px;
    color: #333;
    margin: 0;
    display: block;
    white-space: nowrap;
}

.dose-input-row input[type="number"] {
    width: 45px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏õ‡πâ‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç */
    padding: 6px;
    border-radius: 6px;
    border: 1px solid #ccc;
    text-align: center;
    font-size: 13px;
    box-sizing: border-box;
    height: 30px;
}

.pill-section-title {
    font-weight: 600;
    margin-bottom: 5px;
    padding-bottom: 5px;
    text-align: center; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏•‡πá‡∏Å */
}

.add-row-btn {
    background: var(--light-pink);
    color: var(--main-pink);
    border: 1px solid var(--main-pink);
    padding: 6px 10px;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
    margin-top: 5px;
    font-size: 12px;
    width: 100%; /* ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏Å‡∏£‡∏≠‡∏ö */
}
.add-row-btn:hover { background: #FFDDEE; }

/* üåü ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤ (‡πÇ‡∏ó‡∏ô‡∏Ç‡∏≤‡∏ß) */
.comparison-section {
    flex: 1 1 40%; /* ‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 2mg/3mg */
    padding: 15px;
    border-radius: 8px;
    background: #FFFFFF; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß */
    border: 1px solid #cfd8dc; /* ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
}

.comparison-section h4 {
    margin-top: 0;
    color: #40B2D6;
    border-bottom: 1px dashed #A0D0E0;
    padding-bottom: 5px;
}

.comparison-output {
    margin-top: 15px;
    padding: 15px;
    border: 1px solid #cfd8dc;
    border-left: 5px solid var(--accent-green); 
    border-radius: 8px; 
    background: #F0FFF0;
}

.comparison-output p {
    margin: 5px 0;
    font-size: 16px;
    line-height: 1.5;
}

.comparison-output strong {
    color: var(--accent-green);
    font-weight: 700;
    font-size: 17px;
}

.action-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    justify-content: flex-end;
}

.action-buttons button {
    padding: 10px 15px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    transition: background 0.2s;
}

.calculate-btn {
    background: var(--main-pink);
    color: white;
}
.calculate-btn:hover { background: #C2185B; }

.clear-btn {
    background: #ccc;
    color: #333;
}
.clear-btn:hover { background: #B0B0B0; }

@media(max-width:900px){
    /* ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
    .dosing-comparison-container {
        flex-direction: column;
    }
    .pill-dosing-container {
        flex: 1 1 100%;
        gap: 12px;
    }
    .comparison-section {
        flex: 1 1 100%;
    }
    .dose-input-row {
        flex-wrap: wrap; 
        justify-content: space-between;
    }
    .dose-input-row label {
        width: auto;
    }
    .dose-input-row input[type="number"] {
        width: 60px;
    }
}
</style>
</head>
<body oncontextmenu="return false;">
<div class="container">
    
    <header class="card" style="align-items:center">
        <h1>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏¢‡∏≤ Warfarin ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏û‡∏∏‡∏ô‡∏û‡∏¥‡∏ô</h1>
    </header>
    <section class="card">
        <form id="form">
            <div class="row">
                <div class="col">
                    <label>INR ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                    <input type="number" step="0.01" id="inr" min="0" value="2.5" required>
                </div>
                <div class="col">
                    <label>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ Warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (mg)</label>
                    <input type="number" step="0.1" id="weeklyDose" min="0" required>
                </div>
                <div class="col">
                    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î (‡∏ß‡∏±‡∏ô)</label>
                    <input type="number" id="days" min="1" value="7" required>
                </div>
            </div>
            <div style="margin-top:12px">
                <label>‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</label>
                <div class="radio-row">
                    <label class="pill"><input type="radio" name="pills" value="3" checked> ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡πá‡∏î 3 mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</label>
                    <label class="pill"><input type="radio" name="pills" value="2"> ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡πá‡∏î 2 mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</label>
                    <label class="pill"><input type="radio" name="pills" value="both"> ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á 2 ‡πÅ‡∏•‡∏∞ 3 mg</label>
                    
                    <label class="pill"><input type="radio" name="pills" value="3-no-half-1-day-off"> 3 mg ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á, ‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô</label>
                    <label class="pill"><input type="radio" name="pills" value="2-no-half-1-day-off"> 2 mg ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á, ‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô</label>
                    
                </div>
            </div>
            <div style="margin-top:12px" class="row">
                <div class="col">
                    <label>‡∏†‡∏≤‡∏ß‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å</label>
                    <div class="radio-row">
                        <label class="pill"><input type="radio" name="bleed" value="no" checked> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label>
                        <label class="pill"><input type="radio" name="bleed" value="yes"> ‡∏°‡∏µ</label>
                    </div>
                </div>
                <div class="col">
                    <label>‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</label>
                    <div class="radio-row">
                        <label class="pill"><input type="radio" name="displayMode" value="number" checked> ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</label>
                        <label class="pill"><input type="radio" name="displayMode" value="image"> ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÄ‡∏°‡πá‡∏î‡∏¢‡∏≤</label>
                    </div>
                </div>
            </div>
        </form>
        <div id="results" class="result" style="display:none"></div>
    </section>
    <section id="tables" class="card" style="display:none">
        <h3 style="color:var(--accent)">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏¢‡∏≤ (7 ‡∏ß‡∏±‡∏ô)</h3>
        <div id="plans"></div>
        <div style="margin-top:12px;text-align:right">
            <button onclick="window.print()" class="primary">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î / ‡∏û‡∏¥‡∏°‡∏û‡πå (PDF)</button>
        </div>
    </section>
    
    <div class="standalone-calculator">
        <div class="calculator-header-new">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏≤‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì mg ‡∏£‡∏ß‡∏°‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô ‡∏Ç‡∏≠‡∏á warfarin</div>
        
        <div class="dosing-comparison-container">
            
            <div class="pill-dosing-container">
                <div id="dose2mgContainer" class="dose-input-group">
                    <div class="pill-section-title">Warfarin **2** mg (‡πÄ‡∏°‡πá‡∏î‡∏™‡∏µ‡∏™‡πâ‡∏°)</div>
                    <div class="dose-input-row" data-mg="2">
                        <label>‡πÄ‡∏°‡πá‡∏î:</label>
                        <input type="number" step="0.5" min="0" value="" class="pill-count" oninput="calculateComparison(false)">
                        <label>√ó</label>
                        <input type="number" step="1" min="0" max="7" value="" class="day-count" oninput="calculateComparison(false)">
                        <label>‡∏ß‡∏±‡∏ô</label>
                    </div>
                    <button class="add-row-btn" onclick="addRow(2)">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô/‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ 2 mg</button>
                </div>
            </div>

            <div class="pill-dosing-container">
                <div id="dose3mgContainer" class="dose-input-group">
                    <div class="pill-section-title">Warfarin **3** mg (‡πÄ‡∏°‡πá‡∏î‡∏™‡∏µ‡∏ü‡πâ‡∏≤)</div>
                    <div class="dose-input-row" data-mg="3">
                        <label>‡πÄ‡∏°‡πá‡∏î:</label>
                        <input type="number" step="0.5" min="0" value="" class="pill-count" oninput="calculateComparison(false)">
                        <label>√ó</label>
                        <input type="number" step="1" min="0" max="7" value="" class="day-count" oninput="calculateComparison(false)">
                        <label>‡∏ß‡∏±‡∏ô</label>
                    </div>
                    <button class="add-row-btn" onclick="addRow(3)">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô/‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ 3 mg</button>
                </div>
            </div>

            <div class="comparison-section">
                <h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö/‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î</h4>
                <div class="dose-input-row" style="margin-bottom: 10px;">
                    <label for="initialWeeklyDose" style="width: 150px; color: var(--main-pink);">‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÄ‡∏î‡∏¥‡∏° (mg/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå):</label>
                    <input type="number" step="0.1" id="initialWeeklyDose" min="0" style="width: 70px;" oninput="calculateComparison(false)">
                </div>
                <div class="dose-input-row">
                    <label for="dispenseDays" style="width: 150px; color: var(--main-pink);">‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢ (‡∏ß‡∏±‡∏ô):</label>
                    <input type="number" id="dispenseDays" min="1" style="width: 70px;" oninput="calculateComparison(false)">
                </div>

                <div class="action-buttons">
                    <button class="clear-btn" onclick="clearData()">‡∏•‡πâ‡∏≤‡∏á</button>
                    <button class="calculate-btn" onclick="calculateComparison(true)">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
                </div>
            </div>

        </div> <div id="comparisonResult" class="comparison-output" style="display: none;">
            </div>
    </div>
    <footer class="card small">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤ ‡πÄ‡πÄ‡∏û‡∏ó‡∏¢‡πå/‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</footer>
</div>
<script>
// --- START: COPY PROTECTION CODE (‡πÄ‡∏î‡∏¥‡∏°) ---
document.onkeydown = function(e) {
    if (e.keyCode == 123 || 
        (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) ||
        (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) ||
        (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) ) {
        return false;
    }
};
// --- END: COPY PROTECTION CODE (‡πÄ‡∏î‡∏¥‡∏°) ---

// ******************************************************
// ** GLOBAL FUNCTIONS (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å HTML: onclick/oninput) **
// ******************************************************

/**
 * ‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
 * @param {number} num
 */
function roundTwoDecimals(num) { 
    return Math.round(num * 100) / 100;
}

/**
 * ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô (Global)
 * @param {number} mg - 3 ‡∏´‡∏£‡∏∑‡∏≠ 2
 */
function addRow(mg) {
    const containerId = `dose${mg}mgContainer`;
    const container = document.getElementById(containerId);
    
    if (!container) return; 

    const newRow = document.createElement('div');
    newRow.className = 'dose-input-row';
    newRow.setAttribute('data-mg', mg);
    newRow.innerHTML = `
        <label>‡πÄ‡∏°‡πá‡∏î:</label>
        <input type="number" step="0.5" min="0" value="" class="pill-count" oninput="calculateComparison(false)">
        <label>√ó</label>
        <input type="number" step="1" min="0" max="7" value="" class="day-count" oninput="calculateComparison(false)">
        <label>‡∏ß‡∏±‡∏ô</label>
        <button onclick="removeRow(this)" style="background: none; border: none; color: #E91E63; cursor: pointer; font-weight: bold; font-size: 13px; padding: 0 5px;">[‡∏•‡∏ö]</button>
    `;

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß (lastElementChild)
    container.insertBefore(newRow, container.lastElementChild);
    calculateComparison(false);
}

/**
 * ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤ (Global)
 * @param {HTMLElement} btn - ‡∏õ‡∏∏‡πà‡∏° [‡∏•‡∏ö] ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏î
 */
function removeRow(btn) {
    const row = btn.parentNode;
    row.remove();
    calculateComparison(false);
}

/**
 * ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏£‡∏ß‡∏° (Global)
 * @param {boolean} isManualClick - true ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì'
 */
function calculateComparison(isManualClick) {
    const initialDoseInput = document.getElementById('initialWeeklyDose');
    const daysInput = document.getElementById('dispenseDays');
    const resultDiv = document.getElementById('comparisonResult');

    if (!initialDoseInput || !daysInput || !resultDiv) return;

    // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ 0 ‡πÅ‡∏•‡∏∞ 7 ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
    const initialWeeklyDose = parseFloat(initialDoseInput.value) || 0;
    const dispenseDays = parseInt(daysInput.value) || 7; 
    
    let totalWeeklyMg = 0;
    let total3mgPillsFor7Days = 0;
    let total2mgPillsFor7Days = 0;

    const allDoseRows = document.querySelectorAll('.standalone-calculator .dose-input-row');
    
    allDoseRows.forEach(row => {
        const mg = parseInt(row.getAttribute('data-mg'));
        const pillCountInput = row.querySelector('.pill-count');
        const dayCountInput = row.querySelector('.day-count');
        
        if (!pillCountInput || !dayCountInput) return;
        
        // *** ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ parseFloat() || 0 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á/null/NaN ‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á input ‡∏ß‡πà‡∏≤‡∏á ***
        const pillCount = parseFloat(pillCountInput.value) || 0;
        const dayCount = parseInt(dayCountInput.value) || 0;
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô
        if (dayCount < 0 || dayCount > 7) {
            if (isManualClick) {
                 alert(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Warfarin ${mg} mg ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 0 ‡∏ñ‡∏∂‡∏á 7`);
            }
            return; 
        }
        
        const weeklyMgFromRow = pillCount * mg * dayCount;
        totalWeeklyMg += weeklyMgFromRow;
        
        if (mg === 3) {
            total3mgPillsFor7Days += pillCount * dayCount;
        } else if (mg === 2) {
            total2mgPillsFor7Days += pillCount * dayCount;
        }
    });
    
    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏î‡πÜ ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á Warfarin
    if (totalWeeklyMg === 0 && !isManualClick) {
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏õ‡πâ‡∏≠‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const allEmpty = Array.from(allDoseRows).every(row => {
            const pillCountInput = row.querySelector('.pill-count');
            const dayCountInput = row.querySelector('.day-count');
            return (!pillCountInput.value || pillCountInput.value.trim() === '0') && 
                   (!dayCountInput.value || dayCountInput.value.trim() === '0');
        });
        
        if(allEmpty) {
            resultDiv.style.display = 'none';
            return;
        }
    }
    
    totalWeeklyMg = roundTwoDecimals(totalWeeklyMg);
    const dailyMg = roundTwoDecimals(totalWeeklyMg / 7);
    
    const diffMg = roundTwoDecimals(totalWeeklyMg - initialWeeklyDose);
    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì % ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á
    const diffPct = initialWeeklyDose === 0 ? 
        (totalWeeklyMg === 0 ? 0 : 100) : // ‡∏ñ‡πâ‡∏≤ dose ‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÅ‡∏•‡∏∞ dose ‡πÉ‡∏´‡∏°‡πà > 0 ‡∏Ñ‡∏∑‡∏≠ +100% (‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ 0 ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ)
        roundTwoDecimals((diffMg / initialWeeklyDose) * 100);
    
    if(dispenseDays <= 0 && isManualClick) {
        alert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ö‡∏ß‡∏Å');
    }

    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î (‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô) (‡πÉ‡∏ä‡πâ dispenseDays = 7 ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤)
    const final3mgPills = Math.ceil(total3mgPillsFor7Days * (dispenseDays / 7));
    const final2mgPills = Math.ceil(total2mgPillsFor7Days * (dispenseDays / 7));

    let resultHTML = `
        <p>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (7 ‡∏ß‡∏±‡∏ô): <strong>${totalWeeklyMg.toFixed(2)} mg</strong> (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${dailyMg.toFixed(2)} mg/‡∏ß‡∏±‡∏ô)</p>
        <p>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÄ‡∏î‡∏¥‡∏° (${initialWeeklyDose.toFixed(2)} mg): <strong style="color: ${diffMg >= 0 ? 'red' : 'green'};">${diffMg >= 0 ? '+' : ''}${diffMg.toFixed(2)} mg (${diffPct >= 0 ? '+' : ''}${diffPct.toFixed(2)}%)</strong></p>
        <hr style="border-top: 1px solid #ccc; margin: 10px 0;">
        <p>‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏¢‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö <strong>${dispenseDays} ‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î</strong>:</p>
        <p>Warfarin 3 mg: <strong>${final3mgPills} ‡πÄ‡∏°‡πá‡∏î</strong></p>
        <p>Warfarin 2 mg: <strong>${final2mgPills} ‡πÄ‡∏°‡πá‡∏î</strong></p>
    `;
    
    resultDiv.innerHTML = resultHTML;
    resultDiv.style.display = 'block';
}

/**
 * ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏π‡∏ì‡∏ß‡∏±‡∏ô (Global)
 */
function clearData() {
    const initialDoseInput = document.getElementById('initialWeeklyDose');
    const daysInput = document.getElementById('dispenseDays');
    const resultDiv = document.getElementById('comparisonResult');

    if (!initialDoseInput || !daysInput || !resultDiv) return;

    document.querySelectorAll('.standalone-calculator .dose-input-group').forEach(container => {
        // ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 2 ‡∏´‡∏£‡∏∑‡∏≠ index 1)
        const rows = container.querySelectorAll('.dose-input-row');
        for (let i = 1; i < rows.length; i++) {
            rows[i].remove();
        }
        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÅ‡∏ñ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        const pillCountInput = rows[0].querySelector('.pill-count');
        const dayCountInput = rows[0].querySelector('.day-count');
        if (pillCountInput) pillCountInput.value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
        if (dayCountInput) dayCountInput.value = '';  // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
    });

    initialDoseInput.value = '';
    daysInput.value = '';
    resultDiv.style.display = 'none';
    resultDiv.innerHTML = '';
}


// ******************************************************
// ** DOM CONTENT LOADED (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Event Listeners ‡πÅ‡∏•‡∏∞ Funtions ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô) **
// ******************************************************

document.addEventListener('DOMContentLoaded', function() {
    
    // --- FUNTIONS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÇ‡∏î‡∏¢ Event Listeners (Local) ---
    function roundHalf(x){return Math.round(x*2)/2}
    function distributeEvenly7(total){
        const base = Math.floor(total/7);
        let arr = Array(7).fill(base);
        let rem = total - base*7;
        for(let i=0;i<rem;i++) arr[i]++;
        return arr;
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏¢‡∏≤‡πÅ‡∏ö‡∏ö‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á/‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô (6 ‡∏ß‡∏±‡∏ô‡∏à‡πà‡∏≤‡∏¢)
    function distributeNoHalf1DayOff(totalDose, pillMg) {
        // totalDose ‡∏Ñ‡∏∑‡∏≠ Weekly Dose (mg)
        // ‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô 6 ‡∏ß‡∏±‡∏ô (‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô)
        const dailyTarget = totalDose / 6;
        const totalPills = dailyTarget / pillMg; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°)
        const totalPillCount = Math.round(totalPills * 6); // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏ß‡∏° 6 ‡∏ß‡∏±‡∏ô
        
        let arr = Array(7).fill(0); // 7 ‡∏ß‡∏±‡∏ô, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 7 ‡πÄ‡∏õ‡πá‡∏ô 0
        
        // 1. ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏° (totalPillCount) ‡πÉ‡∏´‡πâ 6 ‡∏ß‡∏±‡∏ô
        const base = Math.floor(totalPillCount / 6);
        let rem = totalPillCount - base * 6;
        for (let i = 0; i < 6; i++) {
            arr[i] = base;
        }
        // ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÄ‡∏®‡∏©‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°
        for (let i = 0; i < rem; i++) {
            arr[i]++; // ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
        }
        
        // arr ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏° (3mg ‡∏´‡∏£‡∏∑‡∏≠ 2mg) ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô 
        // 6 ‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 7 ‡πÄ‡∏õ‡πá‡∏ô 0)
        return { 
            pillsPerDay: arr, // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô
            totalMg: totalDose, // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ
            totalPillCount: totalPillCount // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏ß‡∏° (6 ‡∏ß‡∏±‡∏ô)
        };
    }
    
    function findBestCombo(target){
        // ‡πÉ‡∏ä‡πâ 3mg & 2mg ‡∏ú‡∏™‡∏°, ‡πÉ‡∏ä‡πâ half pill ‡πÑ‡∏î‡πâ
        const numSets = Math.round(target / 5);
        const h3 = numSets;
        const h2 = numSets;
        const total = h3*3 + h2*2;
        return {h3:h3, h2:h2, total:total, type:'5mg'};
    }
    function generatePillImage(count, pillMg){
        let html = '';
        const fullPills = Math.floor(count);
        const hasHalf = count % 1 !== 0;
        const pillClass = pillMg === 3 ? 'pill-icon-3mg' : 'pill-icon-2mg';
        const pillText = `${pillMg} mg`;
        for(let i=0; i<fullPills; i++){
            html += `<div class="pill-icon-wrapper">
                        <span class="pill-icon ${pillClass}"></span>
                        <span class="tooltip-text">${pillText} (‡πÄ‡∏ï‡πá‡∏°‡πÄ‡∏°‡πá‡∏î)</span>
                    </div>`;
        }
        if(hasHalf){
            html += `<div class="pill-icon-wrapper">
                        <span class="pill-icon half-pill ${pillClass}"></span>
                        <span class="tooltip-text">${pillText} (‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î)</span>
                    </div>`;
        }
        return html; 
    }
    
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô buildPlanHTML ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Type ‡πÉ‡∏´‡∏°‡πà
    function buildPlanHTML(title, combo, weeklyDose, displayMode, total3PillCount, total2PillCount, planIndex){
        const dayNames = ['‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå','‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£','‡∏û‡∏∏‡∏ò','‡∏û‡∏§‡∏´‡∏±‡∏™','‡∏®‡∏∏‡∏Å‡∏£‡πå','‡πÄ‡∏™‡∏≤‡∏£‡πå','‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå'];
        const dayClasses = ['mon','tue','wed','thu','fri','sat','sun']; 
        const pillChoice = document.querySelector('input[name="pills"]:checked').value; 
        
        let perDay3 = [];
        let perDay2 = [];
        let totalWeekly = combo.total;

        if (combo.type === '3-no-half-1-day-off') {
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì dose ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô (3mg ‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°, ‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô)
            const dosing = distributeNoHalf1DayOff(weeklyDose, 3); // ‡πÉ‡∏ä‡πâ weeklyDose ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ total mg ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
            perDay3 = dosing.pillsPerDay;
            perDay2 = Array(7).fill(0);
            totalWeekly = perDay3.reduce((sum, count) => sum + count * 3, 0); // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì WeeklyDose ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°
        } else if (combo.type === '2-no-half-1-day-off') {
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì dose ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô (2mg ‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°, ‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô)
            const dosing = distributeNoHalf1DayOff(weeklyDose, 2); // ‡πÉ‡∏ä‡πâ weeklyDose ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ total mg ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
            perDay2 = dosing.pillsPerDay;
            perDay3 = Array(7).fill(0);
            totalWeekly = perDay2.reduce((sum, count) => sum + count * 2, 0); // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì WeeklyDose ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏°
        } else if (combo.type === '3mg') { // ‡πÉ‡∏ä‡πâ 3mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            perDay3 = distributeEvenly7(combo.h3);
            perDay2 = Array(7).fill(0);
        } else if (combo.type === '2mg') { // ‡πÉ‡∏ä‡πâ 2mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            perDay2 = distributeEvenly7(combo.h2);
            perDay3 = Array(7).fill(0);
        } else { // '5mg' ‡∏´‡∏£‡∏∑‡∏≠ 'both' (‡πÉ‡∏ä‡πâ‡∏ú‡∏™‡∏°)
            perDay3 = distributeEvenly7(combo.h3);
            perDay2 = distributeEvenly7(combo.h2);
        }
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ totalWeekly ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        const diffWeekPct = weeklyDose===0?0:((totalWeekly-weeklyDose)/weeklyDose)*100;
        const pctText = `${diffWeekPct>0?'+':''}${diffWeekPct.toFixed(2)}%`;
        
        const days = parseInt(document.getElementById('days').value) || 7; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏°‡πá‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î (totalPillCount ‡πÅ‡∏•‡∏∞ total2PillCount ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)
        let totalPillCountForDispense = 0;
        let total2PillCountForDispense = 0;
        let total3PillCountForDispense = 0;
        
        for(let i=0; i<days; i++) {
            const dayIndex = i % 7; // ‡∏ß‡∏ô‡∏ã‡πâ‡∏≥‡πÅ‡∏ú‡∏ô 7 ‡∏ß‡∏±‡∏ô
            let t3 = perDay3[dayIndex];
            let t2 = perDay2[dayIndex];
            
            // ‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ half pill ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥‡πÑ‡∏õ‡∏´‡∏≤‡∏£ 2 ‡∏Å‡πà‡∏≠‡∏ô
            if (combo.type === '3mg' || combo.type === '2mg' || combo.type === '5mg' || combo.type === 'both') {
                if (pillChoice === '3' || pillChoice === 'both') t3 = t3 / 2;
                if (pillChoice === '2' || pillChoice === 'both') t2 = t2 / 2;
            }
            
            total3PillCountForDispense += t3;
            total2PillCountForDispense += t2;
        }
        
        total3PillCountForDispense = Math.ceil(total3PillCountForDispense);
        total2PillCountForDispense = Math.ceil(total2PillCountForDispense);

        let html = `<div class="plan-section plan-${planIndex}">`;
        html += `<h4>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${title} ‚Äî ‡∏£‡∏ß‡∏° ${totalWeekly.toFixed(2)} mg/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (${pctText} ‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°)</h4>`;
        
        if (displayMode === 'image') {
            html += `<div class="plan-grid">`;
            for(let i=0;i<7;i++){
                let t3 = perDay3[i];
                let t2 = perDay2[i];
                
                // ‡∏Å‡∏£‡∏ì‡∏µ‡πÉ‡∏ä‡πâ half pill ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡∏£ 2
                if (combo.type === '3mg' || combo.type === '2mg' || combo.type === '5mg' || combo.type === 'both') {
                    if (pillChoice === '3' || pillChoice === 'both') t3 = t3 / 2;
                    if (pillChoice === '2' || pillChoice === 'both') t2 = t2 / 2;
                }
                
                const mg = (t3*3 + t2*2).toFixed(1);
                const t3Html = generatePillImage(t3, 3);
                const t2Html = generatePillImage(t2, 2);
                const totalPillUnits = Math.ceil(t3) + Math.ceil(t2);
                const shrinkClass = totalPillUnits >= 5 ? 'shrink-pills' : '';
                let doseText = '';
                if (t3 > 0) doseText += `3 mg x ${t3.toFixed(1).replace('.0','')}\n`;
                if (t2 > 0) doseText += `2 mg x ${t2.toFixed(1).replace('.0','')}`;
                
                html += `
                    <div class="day-card">
                        <div class="day-name ${dayClasses[i]}">${dayNames[i]}</div>
                        <div class="daily-mg">(${mg} mg)</div>
                        <div class="pill-container ${shrinkClass}">${t2Html}${t3Html}</div>
                        <div class="daily-dose-text" style="white-space:pre-line">${doseText.trim()}</div>
                    </div>
                `;
            }
            html += `</div>`;
            
            html += `<h4>‡∏£‡∏ß‡∏°‡∏¢‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${days} ‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î:</h4>`;
            html += `<div class="summary">`;
            if(total3PillCountForDispense > 0) {
                html += `<div class="summary-line"><span class="summary-pill pill-icon-3mg"></span> 3 mg: ${total3PillCountForDispense} ‡πÄ‡∏°‡πá‡∏î</div>`;
            }
            if(total2PillCountForDispense > 0) {
                html += `<div class="summary-line"><span class="summary-pill pill-icon-2mg"></span> 2 mg: ${total2PillCountForDispense} ‡πÄ‡∏°‡πá‡∏î</div>`;
            }
            html += `</div>`;
            
        } else {
            const pillTypes = [];
            
            // ‡πÉ‡∏ä‡πâ t3, t2 ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô
            if (pillChoice === '3' || pillChoice === 'both' || pillChoice === '3-no-half-1-day-off') pillTypes.push({ label: '3 mg (‡πÄ‡∏°‡πá‡∏î)', type: 3 });
            if (pillChoice === '2' || pillChoice === 'both' || pillChoice === '2-no-half-1-day-off') pillTypes.push({ label: '2 mg (‡πÄ‡∏°‡πá‡∏î)', type: 2 });
            
            pillTypes.push({ label: '‡∏£‡∏ß‡∏° (mg)', type: 'total' });
            
            let headerCols = `<th>‡∏ä‡∏ô‡∏¥‡∏î‡∏¢‡∏≤</th>`;
            dayNames.forEach(day => { headerCols += `<th>${day}</th>`; });
            html += `<table class="plan-table plan-${planIndex}"><thead><tr>${headerCols}</tr></thead><tbody>`;
            
            pillTypes.forEach(pillType => {
                let dataRow = `<tr><td style="font-weight: 600;">${pillType.label}</td>`;
                for(let i=0;i<7;i++){
                    let t3_value = perDay3[i]; // ‡πÄ‡∏°‡πá‡∏î ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î * 2
                    let t2_value = perDay2[i]; // ‡πÄ‡∏°‡πá‡∏î ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î * 2
                    
                    // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ t3, t2 ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
                    let t3 = t3_value;
                    let t2 = t2_value;
                    if (combo.type === '3mg' || combo.type === '2mg' || combo.type === '5mg' || combo.type === 'both') {
                        if (pillChoice === '3' || pillChoice === 'both') t3 = t3 / 2;
                        if (pillChoice === '2' || pillChoice === 'both') t2 = t2 / 2;
                    }
                    
                    const mg = (t3 * 3 + t2 * 2).toFixed(2);
                    let value = '';
                    
                    if (pillType.type === 3) {
                        value = t3 % 1 === 0 ? t3 : t3.toFixed(1);
                    } else if (pillType.type === 2) {
                        value = t2 % 1 === 0 ? t2 : t2.toFixed(1);
                    } else if (pillType.type === 'total') {
                        value = mg;
                    }
                    dataRow += `<td>${value}</td>`;
                }
                dataRow += `</tr>`;
                html += dataRow;
            });
            html += `</tbody></table>`;
            
            let noteText = `‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏¢‡∏≤ (${days} ‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î)\n`;
            if(total3PillCountForDispense > 0 && (pillChoice === '3' || pillChoice === 'both' || pillChoice === '3-no-half-1-day-off')) noteText += `‡∏£‡∏ß‡∏° 3 mg: ${total3PillCountForDispense} ‡πÄ‡∏°‡πá‡∏î\n`;
            if(total2PillCountForDispense > 0 && (pillChoice === '2' || pillChoice === 'both' || pillChoice === '2-no-half-1-day-off')) noteText += `‡∏£‡∏ß‡∏° 2 mg: ${total2PillCountForDispense} ‡πÄ‡∏°‡πá‡∏î`;
            
            if(noteText.trim()) html += `<div class="note" style="white-space:pre-line">${noteText}</div>`;
        }
        
        html += `</div>`;
        return html;
    }
    
    // **‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô calculate() ‡πÄ‡∏î‡∏¥‡∏°:**
    function calculate(){
        const inrInput = document.getElementById('inr');
        const weeklyDoseInput = document.getElementById('weeklyDose');
        const daysInput = document.getElementById('days');
        const resDiv = document.getElementById('results');
        const tables = document.getElementById('tables');
        const plansDiv = document.getElementById('plans');
        
        if (!inrInput || !weeklyDoseInput || !daysInput) return;

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (inrInput.value.trim() === '' || weeklyDoseInput.value.trim() === '' || daysInput.value.trim() === '') {
            resDiv.style.display = 'none';
            tables.style.display = 'none';
            return;
        }

        const INR = parseFloat(inrInput.value);
        let weeklyDose = parseFloat(weeklyDoseInput.value);
        const days = parseInt(daysInput.value);
        const bleed = document.querySelector('input[name="bleed"]:checked').value;
        const pillChoice = document.querySelector('input[name="pills"]:checked').value;
        const displayMode = document.querySelector('input[name="displayMode"]:checked').value;

        // ‡∏õ‡∏£‡∏±‡∏ö weekly dose ‡∏ï‡∏≤‡∏° INR
        let adjustedWeeklyDose = weeklyDose;
        let recommendation = '';
        let adjustmentFactor = 0;

        if (bleed === 'yes') {
            recommendation = '‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ 1 ‡∏ß‡∏±‡∏ô, ‡∏ï‡∏£‡∏ß‡∏à INR ‡∏ã‡πâ‡∏≥‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î';
            adjustedWeeklyDose = 0; // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≤, ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î
        } else if (INR < 1.5) {
            adjustmentFactor = 0.25;
            recommendation = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ 25%';
            adjustedWeeklyDose *= (1 + adjustmentFactor);
        } else if (INR >= 1.5 && INR <= 2.0) {
            adjustmentFactor = 0.10;
            recommendation = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ 10%';
            adjustedWeeklyDose *= (1 + adjustmentFactor);
        } else if (INR > 2.0 && INR <= 3.0) {
            recommendation = '‡∏Ñ‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÄ‡∏î‡∏¥‡∏°';
            adjustmentFactor = 0;
        } else if (INR > 3.0 && INR <= 4.0) {
            adjustmentFactor = -0.10;
            recommendation = '‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ 10%';
            adjustedWeeklyDose *= (1 + adjustmentFactor);
        } else if (INR > 4.0 && INR <= 5.0) {
            adjustmentFactor = -0.25;
            recommendation = '‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ 25%';
            adjustedWeeklyDose *= (1 + adjustmentFactor);
        } else if (INR > 5.0) {
            recommendation = '‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ 1 ‡∏ß‡∏±‡∏ô, ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ 50%';
            adjustedWeeklyDose *= 0.5;
        }

        adjustedWeeklyDose = roundTwoDecimals(adjustedWeeklyDose);
        const dailyDose = roundTwoDecimals(adjustedWeeklyDose / 7);

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≤
        let resultHTML = `
            <h3>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≤ Warfarin</h3>
            <p><strong>INR:</strong> ${INR.toFixed(2)}</p>
            <p><strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ${recommendation}</p>
            <p><strong>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå:</strong> <strong style="color:var(--accent-green);">${adjustedWeeklyDose.toFixed(2)} mg</strong></p>
            <p class="small">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${dailyDose.toFixed(2)} mg/‡∏ß‡∏±‡∏ô</p>
            <div style="margin-top:15px">
                <label>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏¢‡∏≤‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ ${adjustedWeeklyDose.toFixed(2)} mg/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå):</label>
            </div>
        `;
        resDiv.innerHTML = resultHTML;
        resDiv.style.display = 'block';

        // ‡∏´‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏¢‡∏≤
        let plansHTML = '';
        let plans = [];
        
        // --- 1. ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏¢‡∏≤‡πÄ‡∏î‡∏¥‡∏° (‡πÉ‡∏ä‡πâ half pill ‡πÑ‡∏î‡πâ) ---
        if (adjustedWeeklyDose > 0 && (pillChoice === '3' || pillChoice === '2' || pillChoice === 'both')) {
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô half-pill-units ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
            // 1 unit = 0.5 ‡πÄ‡∏°‡πá‡∏î (‡πÄ‡∏ä‡πà‡∏ô 3mg half pill unit = 1.5 mg)
            const unitsNeeded = adjustedWeeklyDose * 2;
            const fullUnit = Math.floor(unitsNeeded);
            const halfUnit = unitsNeeded - fullUnit;
            
            // ‡∏´‡∏≤‡∏ä‡∏∏‡∏î‡πÄ‡∏°‡πá‡∏î‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
            let combo3mg = {h3:0, h2:0, total:0, type:'3mg'}; // ‡πÉ‡∏ä‡πâ 3mg ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            let combo2mg = {h3:0, h2:0, total:0, type:'2mg'}; // ‡πÉ‡∏ä‡πâ 2mg ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            let comboBoth = {h3:0, h2:0, total:0, type:'both'}; // ‡πÉ‡∏ä‡πâ‡∏ú‡∏™‡∏°

            // **1.1 ‡πÉ‡∏ä‡πâ 3 mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (half-pill unit)**
            if(pillChoice === '3'){
                combo3mg.h3 = fullUnit + (halfUnit > 0 ? 1 : 0);
                combo3mg.total = combo3mg.h3 * 1.5;
                plans.push({title:'‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡πá‡∏î 3 mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á)', combo:combo3mg});
            }

            // **1.2 ‡πÉ‡∏ä‡πâ 2 mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (half-pill unit)**
            if(pillChoice === '2'){
                combo2mg.h2 = fullUnit + (halfUnit > 0 ? 1 : 0);
                combo2mg.total = combo2mg.h2 * 1.0;
                plans.push({title:'‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡πá‡∏î 2 mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á)', combo:combo2mg});
            }

            // **1.3 ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á 2 ‡πÅ‡∏•‡∏∞ 3 mg (half-pill unit)**
            if(pillChoice === 'both'){
                comboBoth = findBestCombo(unitsNeeded); // ‡∏™‡∏π‡∏ï‡∏£ findBestCombo ‡∏à‡∏∞‡πÉ‡∏´‡πâ h3, h2 ‡πÄ‡∏õ‡πá‡∏ô half-pill unit
                plans.push({title:'‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡πá‡∏î 3 mg ‡πÅ‡∏•‡∏∞ 2 mg ‡∏ú‡∏™‡∏° (‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á)', combo:comboBoth});
            }
        }
        
        // --- 2. ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà (‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á, ‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô) ---
        if (adjustedWeeklyDose > 0) {
            // **2.1 3 mg ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á, ‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô**
            if (pillChoice === '3-no-half-1-day-off') {
                const comboNoHalf3 = {
                    h3: 0, 
                    h2: 0, 
                    total: adjustedWeeklyDose, // ‡πÉ‡∏ä‡πâ total mg ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å INR
                    type: '3-no-half-1-day-off'
                };
                plans.push({title:'3 mg (‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á, ‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô)', combo:comboNoHalf3});
            }
            
            // **2.2 2 mg ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á, ‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô**
            if (pillChoice === '2-no-half-1-day-off') {
                const comboNoHalf2 = {
                    h3: 0, 
                    h2: 0, 
                    total: adjustedWeeklyDose, // ‡πÉ‡∏ä‡πâ total mg ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å INR
                    type: '2-no-half-1-day-off'
                };
                plans.push({title:'2 mg (‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á, ‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô)', combo:comboNoHalf2});
            }
        }
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≤
        plans.forEach((plan, index) => {
            let total3PillCount = 0;
            let total2PillCount = 0;
            
            if (plan.combo.type === '3-no-half-1-day-off') {
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏°‡πá‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏à‡∏≤‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà
                const { totalPillCount } = distributeNoHalf1DayOff(adjustedWeeklyDose, 3);
                const dispenseMultiplier = days / 7;
                total3PillCount = Math.ceil(totalPillCount * dispenseMultiplier);
                total2PillCount = 0;
            } else if (plan.combo.type === '2-no-half-1-day-off') {
                const { totalPillCount } = distributeNoHalf1DayOff(adjustedWeeklyDose, 2);
                const dispenseMultiplier = days / 7;
                total2PillCount = Math.ceil(totalPillCount * dispenseMultiplier);
                total3PillCount = 0;
            } else {
                // ‡πÅ‡∏ú‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡πÉ‡∏ä‡πâ half pill)
                let totalUnits = plan.combo.h3 + plan.combo.h2; // ‡∏£‡∏ß‡∏° half-pill unit 7 ‡∏ß‡∏±‡∏ô
                const dispenseMultiplier = days / 7;
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏ï‡πá‡∏° + ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏°‡πá‡∏î (‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î
                if(pillChoice === '3' || pillChoice === 'both'){
                    total3PillCount = Math.ceil((plan.combo.h3 / 2) * dispenseMultiplier);
                }
                if(pillChoice === '2' || pillChoice === 'both'){
                    total2PillCount = Math.ceil((plan.combo.h2 / 2) * dispenseMultiplier);
                }
            }

            plansHTML += buildPlanHTML(
                plan.title, 
                plan.combo, 
                weeklyDose, // ‡πÉ‡∏ä‡πâ weeklyDose ‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì % ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á
                displayMode, 
                total3PillCount, 
                total2PillCount, 
                index + 1
            );
        });

        plansDiv.innerHTML = plansHTML;
        tables.style.display = plans.length > 0 ? 'block' : 'none';
    }

    // --- Event Listeners ‡πÄ‡∏î‡∏¥‡∏° ---
    const form = document.getElementById('form');
    form.addEventListener('input', calculate);

    // Initial calculation on load
    calculate();

    // Fix for pill radio selection style
    const pillsRadios = document.querySelectorAll('input[name="pills"]');
    pillsRadios.forEach(radio => {
        radio.parentNode.classList.add('pill'); // ‡πÄ‡∏û‡∏¥‡πà‡∏° class 'pill' ‡πÉ‡∏´‡πâ label ‡∏Ç‡∏≠‡∏á radio
        radio.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô radio button ‡∏à‡∏£‡∏¥‡∏á
        
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        if (radio.checked) {
            radio.parentNode.style.backgroundColor = 'var(--highlight)';
            radio.parentNode.style.color = '#004D40';
        }

        radio.addEventListener('change', function() {
            pillsRadios.forEach(r => {
                r.parentNode.style.backgroundColor = '#E0F2F1';
                r.parentNode.style.color = '#263238';
            });
            if (this.checked) {
                this.parentNode.style.backgroundColor = 'var(--highlight)';
                this.parentNode.style.color = '#004D40';
            }
        });
    });
    
    // Fix for bleed radio selection style
    const bleedRadios = document.querySelectorAll('input[name="bleed"]');
    bleedRadios.forEach(radio => {
        radio.parentNode.classList.add('pill');
        radio.style.display = 'none';
        
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        if (radio.checked) {
            radio.parentNode.style.backgroundColor = 'var(--highlight)';
            radio.parentNode.style.color = '#004D40';
        }

        radio.addEventListener('change', function() {
            bleedRadios.forEach(r => {
                r.parentNode.style.backgroundColor = '#E0F2F1';
                r.parentNode.style.color = '#263238';
            });
            if (this.checked) {
                this.parentNode.style.backgroundColor = 'var(--highlight)';
                this.parentNode.style.color = '#004D40';
            }
        });
    });
    
    // Fix for displayMode radio selection style
    const displayModeRadios = document.querySelectorAll('input[name="displayMode"]');
    displayModeRadios.forEach(radio => {
        radio.parentNode.classList.add('pill');
        radio.style.display = 'none';
        
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        if (radio.checked) {
            radio.parentNode.style.backgroundColor = 'var(--highlight)';
            radio.parentNode.style.color = '#004D40';
        }

        radio.addEventListener('change', function() {
            displayModeRadios.forEach(r => {
                r.parentNode.style.backgroundColor = '#E0F2F1';
                r.parentNode.parentNode.style.color = '#263238';
            });
            if (this.checked) {
                this.parentNode.style.backgroundColor = 'var(--highlight)';
                this.parentNode.style.color = '#004D40';
            }
        });
    });
    
});
</script>
</body>
</html>
